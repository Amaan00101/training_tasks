## Project 01: Prometheus Monitoring and Alerting Setup

### Overview

This project involves setting up a Prometheus server to monitor various services across different nodes. It includes configuring Prometheus with jobs and targets, using exporters to gather metrics, writing PromQL queries, and setting up alerting and notification systems.

### Project Breakdown

### 1. Configuring Jobs and Targets
**Task:** Set up a Prometheus server to monitor multiple services running on different nodes.

**Deliverables:**
- Configure Prometheus with jobs for monitoring different services (e.g., web servers, databases, system metrics).
- Define static and dynamic targets using file-based and service discovery methods (e.g., Consul or Kubernetes).
```yaml
scrape_configs:
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]

  - job_name: "node"
    static_configs:
      - targets: ["localhost:9100"]
```
![alt text](<images/Screenshot from 2024-08-12 16-50-29.png>)
---


### 2. Using Exporters (Node Exporter)
**Task:** Use Node Exporter to monitor system-level metrics like CPU, memory, disk usage, and network statistics.

**Deliverables:**
- Install and configure Node Exporter on all nodes.
- Ensure Node Exporter metrics are being scraped by Prometheus.

![alt text](<../day-21/images/Screenshot from 2024-08-08 18-27-47.png>)

![alt text](<images/Screenshot from 2024-08-12 15-47-51.png>)
---


### 3. Hands-on Exercise: Setting Up Exporters
**Task:** Configure at least two different types of exporters (e.g., Node Exporter and MySQL Exporter) and integrate them with Prometheus.

**Deliverables:**
- Demonstrate successful data collection from both exporters.
- Create a basic Prometheus dashboard to visualize key metrics.

![alt text](<images/Screenshot from 2024-08-12 16-54-54.png>)
---


### 4. Introduction to PromQL
**Task:** Learn and implement basic PromQL queries to extract meaningful data from the collected metrics.

**Deliverables:**
- Write basic queries to retrieve metrics like average CPU usage, memory consumption, and disk I/O over time.

**Graph of average CPU usage**
```sql
avg(rate(node_cpu_seconds_total{mode="user"}[5m])) by (instance)
```
![alt text](<images/Screenshot from 2024-08-12 16-39-18.png>)
---


**Graph of memory consumption**
```
node_memory_MemTotal_bytes - node_memory_MemFree_bytes
```
![alt text](<images/Screenshot from 2024-08-12 16-40-14.png>)
---


**Graph of disk I/O over time**
```
avg(rate(node_disk_written_bytes_total[5m])) by (instance)
```
![alt text](<images/Screenshot from 2024-08-12 16-40-41.png>)
---


### 5. Basic Queries (Selectors, Functions, Operators)
**Task:** Create PromQL queries using selectors, functions, and operators to filter and manipulate time-series data.

**Deliverables:**
- Write PromQL queries to calculate the 95th percentile of CPU usage.
- Use functions like `rate()`, `increase()`, and `histogram_quantile()` for analysis.



### 6. Advanced Queries and Aggregations
**Task:** Perform advanced data aggregation using PromQL.

**Deliverables:**
- Write queries to calculate total memory usage and maximum disk space usage.

**Graph of total memory usage across all nodes**
```
sum(node_memory_MemTotal_bytes - node_memory_MemFree_bytes)
```
![alt text](<images/Screenshot from 2024-08-12 16-41-05.png>)
---

**Graph of maximum disk space usage among all nodes**
```
max(node_filesystem_size_bytes - node_filesystem_free_bytes)
```
![alt text](<images/Screenshot from 2024-08-12 16-41-36.png>)
---


### 7. Configuring Alertmanager
**Task:** Set up Alertmanager to handle alerts generated by Prometheus.

**Deliverables:**
- Configure Alertmanager with Prometheus.
- Create routing rules for alert notifications.

**installing the alertmanager**
```
wget https://github.com/prometheus/alertmanager/releases/download/v0.27.0/alertmanager-0.27.0.linux-amd64.tar.gz
tar -xvf alertmanager-0.27.0.linux-amd64.tar.gz 
cd alertmanager-0.27.0.linux-amd64/
```
![alt text](<images/Screenshot from 2024-08-12 16-54-54.png>)
---


### 8. Writing Alerting Rules
**Task:** Write custom alerting rules in Prometheus to trigger alerts based on specific conditions.

**Deliverables:**
- Create alerting rules for high CPU usage, memory leaks, and low disk space.
- Ensure alerts are correctly generated and sent to Alertmanager.

![alt text](<images/Screenshot from 2024-08-12 16-48-41.png>)
---


### 9. Setting Up Notification Channels (Email, Slack, etc.)
**Task:** Integrate Alertmanager with multiple notification channels like Email and Slack.

**Deliverables:**
- Set up Email notifications for critical alerts.
- Integrate Slack for real-time alerts.

**Setting up alertmanager.yml**
![alt text](<images/Screenshot from 2024-08-12 17-24-05.png>)
---


### 10. Hands-on Exercise: Creating Alerts
**Task:** Test the entire alerting pipeline by creating and triggering custom alerts.

**Deliverables:**
- Simulate a scenario where a node exceeds 90% CPU usage.
- Ensure alerts are triggered and sent to both Email and Slack.
- Validate the alerts in both notification channels.

![alt text](<images/Screenshot from 2024-08-12 15-46-33.png>)

![alt text](<images/Screenshot from 2024-08-12 15-40-17.png>)

![alt text](<images/Screenshot from 2024-08-12 15-46-15.png>)
---